Respect locks in the solver
Treat any starter whose game has started as fixedâ€”they must remain in the lineup and in their current slot.
type Slot = 'QB'|'RB'|'WR'|'TE'|'FLEX'|'SUPER_FLEX'|'K'|'DEF';

function isLocked(p: Player, nowUtc: number): boolean {
  // Prefer Sleeperâ€™s fields if you have them:
  // p.metadata.game_start (epoch ms), p.metadata.status ('in_progress','final')
  if (p.metadata?.status === 'in_progress' || p.metadata?.status === 'final') return true;
  if (p.metadata?.game_start && p.metadata.game_start <= nowUtc) return true;
  return false;
}

function optimizeLineupRespectingLocks(roster: Player[], starters: Starter[], slots: Slot[], nowUtc: number) {
  // 1) Freeze locked starters in their EXACT current slots
  const fixed: Starter[] = starters.filter(s => isLocked(s.player, nowUtc));

  // 2) Build the pool of movable players (bench + unlocked starters)
  const movablePlayers = [
    ...starters.filter(s => !isLocked(s.player, nowUtc)).map(s => s.player),
    ...roster.filter(p => !starters.some(s => s.player.id === p.id)) // bench
  ].filter(p => !isLocked(p, nowUtc));

  // 3) Build remaining open slots (exclude fixed ones)
  const openSlots: Slot[] = slots.filter(slot => !fixed.some(f => f.slot === slot));

  // 4) Run your assignment/DP/greedy on movablePlayers â†’ openSlots with slot legality rules
  const reassigned = assignBest(movablePlayers, openSlots);

  // 5) Return full lineup = fixed + reassigned
  return [...fixed, ...reassigned];
}

Key points


Locked starters stay in their current slot, not just â€œmust start.â€ That prevents â€œmove TE to FLEXâ€ cascades that touch them.


Exclude locked bench players from being considered in moves (edge case if someone benched a player who already played).


2) Block â€œSuggested Changesâ€ that touch locks
When you diff currentStarters vs newStarters, drop any step that would:


bench/move a locked player, or


require inserting someone into a slot already occupied by a locked player.


Instead, show a Blocked by lock note.
if (isLocked(outPlayer, nowUtc)) {
  blocked.push({
    reason: 'locked',
    message: `${outPlayer.name} already played. Changes to ${outPlayer.slot} are locked.`
  });
  continue; // donâ€™t surface this suggestion
}

3) Show â€œReachable Optimalâ€ vs â€œFull Optimalâ€
After lock, your optimizer will find two totals:


Full Optimal (ignores locks) â†’ useful for hindsight only


Reachable Optimal (respects locks) â†’ what the user can actually still do


In the card:


Î” +X.X pts (reachable)


Small subtext: Full optimal would be +Y.Y (includes locked players)


4) Clear UI affordances


Add a LOCKED chip beside any starter whoâ€™s played (and dim that row).


In the suggested-steps list:


if a cascade would bench a locked player, show a pale, disabled step with a lock icon and the message above.




In league rows, add a tiny legend dot:


ğŸ”’ = has locked starters




5) Timezone & reliability


Always compare against UTC epoch. Convert Sleeperâ€™s times once on ingest:
const nowUtc = Date.now();
const kickoffUtc = Number(player.metadata.game_start); // already epoch



Donâ€™t rely on client timezone. If you compute on server, pass nowUtc to the client with the payload so both sides agree.


Fallback if a data feed is late: if status says final/in_progress, trust it over kickoff time.


6) Tests you should add (quick)


TE started (locked) sitting at TE; candidate TE available â†’ solver can only place FA at FLEX if legal.


TE started (locked) at FLEX; solver must not move him out of FLEX.


Locked WR on bench â†’ ensure not considered for moves.


â€œSuggested Changesâ€ never lists a step touching a locked player; instead shows Blocked by lock.


7) Small UI copy tweaks


Change section title to Apply These Steps and show:
â• Add FA Cade Otton â†’ FLEX
ğŸ” Move Dalton Kincaid TE â†’ FLEX   (disabled â€” blocked by lock) ğŸ”’
â¬‡ï¸ Bench Jakobi Meyers              (disabled â€” blocked by lock) ğŸ”’
â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•
âœ… Reachable gain: +0.0 pts
â„¹ï¸ Full optimal (ignores locks): +10.8 pts



Implementing the lock-aware optimizer + blocked-step rendering will stop the tool from telling users to replace Brock Bowers after kickoff, and it will make the remaining, actually actionable moves crystal clear.